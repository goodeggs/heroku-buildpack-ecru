#!/usr/bin/env bash

set -e            # fail fast
set -o pipefail   # don't ignore exit codes when piping output
# set -x          # enable debugging

# Configure directories
build_dir=$1
cache_dir=$2
env_dir=$3

# Point the system ruby at a writeable directory
mkdir -p $build_dir/.profile.d
cat > $build_dir/.profile.d/ruby.sh <<-EOF
  export GEM_HOME="\$HOME/vendor/ruby_gems"
  export PATH="\$GEM_HOME/bin:\$PATH"
EOF

# Source it!
. $build_dir/.profile.d/ruby.sh

# Install our rubygems.
gem install dpl

exit 0
